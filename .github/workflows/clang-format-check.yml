name: clang-format Check
on:
  pull_request:
  workflow_dispatch:
jobs:
  formatting-check:
    name: Formatting Check
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # When re-running a PR job, GitHub Actions uses the merge commit created at
    # the time of the original run, not a fresh merge with the latest target branch.
    # This step ensures we always test against the most recent target branch.
    - name: Merge with latest target branch (pull_request only)
      if: github.event_name == 'pull_request'
      run: |
        git fetch origin ${{ github.event.pull_request.base.ref }}
        git merge --no-edit origin/${{ github.event.pull_request.base.ref }}

    - name: Run clang-format style check for C/C++/Protobuf programs.
      uses: jidicula/clang-format-action@v4.16.0
      with:
        clang-format-version: '14'
        check-path: '.'
        fallback-style: 'Google' # optional
